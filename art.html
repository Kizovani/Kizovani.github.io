<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" rel="stylesheet" href="main.css">
    <title>Kizovani - Art</title>
    <style>
       :root {
    --white: #ffffff;
    --black: #000000;
  }

  @font-face {
    font-family: "Arame Mono";
    src: url("/res/fonts/ArameMono.ttf") format("truetype");
}

@font-face {
  font-family: "Hack-Regular";
  src: url(/res/fonts/Hack-Regular.ttf);
}

@font-face {
  font-family: "Hack-Bolditalic";
src: url(/res/fonts/Hack-BoldItalic.ttf);
}

@font-face {
  font-family: "Hack-Italic";
  src: url(/res/fonts/Hack-Italic.ttf);
}

@font-face {
  font-family: "Hack-Bold";
  src: url(/res/fonts/Hack-Bold.ttf);
}

html, body {
    width: 100%;
    height: 100%;
    font-family: "Hack-Regular";
}
img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.img-previews {
    position: absolute;
    top: 0%;
    left: 50%;
    transform: translateX(-50%);
    width: 600px; /* Fixed width instead of percentage */
    padding-bottom: 50vh; /* Space for scrolling */
}

.img-previews img {
    width: 100%;
    height: 700px;
    object-fit: cover; /* Consistent image cropping */
    margin-bottom: 1em;
}

.gallery-container {
    width: 100%;
    height: 100%;
    padding-top: 4em;
}
.gallery.layout-2-gallery {
    position: fixed;
    top: 25%;
    left: 10%;
    transform: translateX(0%);
    width: 75px; /* Fixed width */
}
.gallery.layout-2-gallery .img {
    width: 100%;
    height: 90px;
    margin-bottom: 1em;
    overflow: hidden;
}
.gallery.layout-2-gallery img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Match main gallery cropping */
}

.minimap {
    position: fixed;
    top: 50%;           /* Center vertically */
    left: 100px;        /* Fixed distance from left */
    transform: translateY(-50%); /* Center the element itself */
    transform: translateX(0);
    width: 250px;
    height: 130px;
    border: 2px solid var(--white);
    border-radius: 2px;
    z-index: 2;
    background: rgba(255, 255, 255, 0.1);
    pointer-events: none;
    will-change: transform;
}

/* Adjust the highlight style */
.minimap-highlight {
    position: absolute;
    width: 100%;
    height: 30px;
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(0);
}

.minimap::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 30px;
    background: rgba(255, 255, 255, 0.4); /* More visible indicator */
    top: 0;
    left: 0;
    border-radius: 1px;
}
.lenis.lenis-smooth {
    scroll-behavior: auto !important;
}

.lenis.lenis-smooth [data-lenis-prevent] {
    overscroll-behavior: contain;
}
.lenis.lenis-stopped {
    overflow: hidden;
}
.lenis.lenis-smooth iframe {
 pointer-events: none;   
}

    </style>
</head>
<body>
    <div class="gallery-container">
        <div class="gallery layout-2-gallery">
            <div class="img" id="img1">
                <img src="res/art/fallen_angel.jpg" alt="fallen_angel">
            </div>
            <div class="img" id="img2">
                <img src="res/art/I_LAUGH_BECAUSE_I_AM_WEAK.png" alt="fallen_angel">
            </div>
            <div class="img" id="img3">
                <img src="/res/art/I'M_IN_HELL.png" alt="wolf">
            </div>
            <div class="img" id="img4">
                <img src="/res/art/IT_KEEPS_GETTING_WORSE.png" alt="placeholder">
            </div>
            <div class="img" id="img5">
                <img src="res/art/LETS_NEGOTIATE.png" alt="placeholder">
            </div>
            <div class="img" id="img6">
                <img src="res/art/Melencolia.png" alt="placeholder">
            </div>
            <div class="img" id="img7">
                <img src="/res/art/Screenshot 2024-12-13 at 22-32-59 PITCH CANKER (@pitchcanker) • Instagram photos and videos.png" alt="placeholder">
            </div>
            <div class="img" id="img8">
                <img src="res/art/TEST.png" alt="placeholder">
            </div>
            <div class="img" id="img9">
                <img src="res/art/The_Agression_Sessions.png" alt="placeholder">
            </div>

        </div>
    </div>

    <div class="minimap"></div>

    <div class="img-previews">
        <img src="res/art/fallen_angel.jpg" alt="fallen_angel">
        <img src="res/art/I_LAUGH_BECAUSE_I_AM_WEAK.png" alt="">
        <img src="/res/art/I'M_IN_HELL.png" alt="wolf">
        <img src="res/art/IT_KEEPS_GETTING_WORSE.png" alt="placeholder">
        <img src="res/art/LETS_NEGOTIATE.png" alt="">
        <img src="res/art/Melencolia.png" alt="">
        <img src="/res/art/Screenshot 2024-12-13 at 22-32-59 PITCH CANKER (@pitchcanker) • Instagram photos and videos.png" alt="">
        <img src="res/art/TEST.png" alt="">
        <img src="res/art/The_Agression_Sessions.png" alt="">

    </div>

    <div class="menu-container">
        <div class="col col-1">
            <div class="menu-item" id="menu-toggle">menu</div>
        </div>
        <div class="col col-2">
            <div class="menu-item" id="close-menu">close</div>
            <div class="menu-item"><a href="index.html">home</a></div>
            <div class="menu-item"><a href="projects.html">projects</a></div>
            <div class="menu-item">art i like</div>
            <div class="menu-item"><a href="info.html">info</a></div>
            <div class="menu-item">contact</div>
        </div>
    </div>
    <div class="marquee-container">
        <div class="marquee">
            projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects projects
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.3.1/gsap.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script type="module" src="/main.js"></script>

    <!-- GSAP Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Flip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>
    <script src="https://unpkg.com/lenis@1.1.18/dist/lenis.min.js"></script>

    <script>
        //BELOW IS ALL THE FUNCTIONALITY FOR THE SCROLLBAR AND PREVIEW WINDOW THING
        const lenis = new Lenis();
function raf(time) {
    lenis.raf(time);
    requestAnimationFrame(raf);
}
requestAnimationFrame(raf);

gsap.registerPlugin(ScrollToPlugin);

const gallery = document.querySelector('.layout-2-gallery');
const imgPreviews = document.querySelector('.img-previews');
const minimap = document.querySelector('.minimap');

// Add highlight box if it doesn't exist
if (!minimap.querySelector('.minimap-highlight')) {
    const highlight = document.createElement('div');
    highlight.className = 'minimap-highlight';
    minimap.appendChild(highlight);

    // Add CSS for the highlight
    const style = document.createElement('style');
    style.textContent = `
        .minimap {
            overflow: hidden;
            position: fixed;
            background: rgba(0, 0, 0, 0.2); /* Darkened background to see movement better */
        }
        .minimap-highlight {
            position: absolute;
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(0);
        }
    `;
    document.head.appendChild(style);
}

function handleScroll() {
    // Get the highlight element
    const highlight = minimap.querySelector('.minimap-highlight');
    
    // Get dimensions
    const previewsRect = imgPreviews.getBoundingClientRect();
    const minimapHeight = minimap.offsetHeight;
    const highlightHeight = highlight.offsetHeight;
    const viewportHeight = window.innerHeight;
    const totalScrollHeight = imgPreviews.scrollHeight - viewportHeight;
    
    // Calculate scroll progress as a ratio of how far through the previews we've scrolled
    const scrollProgress = window.scrollY / totalScrollHeight;
    const boundedProgress = Math.min(Math.max(scrollProgress, 0), 1);
    
    // Calculate available travel space in minimap
    const availableMinimapTravel = minimapHeight - highlightHeight;
    
    // Move highlight
    const highlightY = boundedProgress * availableMinimapTravel;
    
    gsap.to(highlight, {
        y: highlightY,
        duration: 0.1,
        ease: "none"
    });

    // Move gallery with same ratio
    const galleryStart = viewportHeight * 0.25;
    const maxTravel = viewportHeight * 0.95;
    const galleryY = galleryStart - (boundedProgress * maxTravel);

    gsap.to(gallery, {
        y: galleryY,
        duration: 0.1,
        ease: "none"
    });

    // Debug info
    console.log({
        scrollProgress,
        highlightY,
        totalHeight: imgPreviews.scrollHeight,
        scrollY: window.scrollY
    });
}

// Use only Lenis for smooth scrolling
lenis.on('scroll', handleScroll);

// Initialize on load
window.addEventListener('load', handleScroll);
        // Get DOM elements
        const fullscreenContainer = document.querySelector('.fullscreen-container');
        const fullscreenImage = fullscreenContainer.querySelector('.fullscreen-image');
        const closeButton = document.querySelector('.close-button');
        let activeImage = null;

        // Function to open fullscreen ITS BROKEN LMFAO
        function openFullscreen(image) {
    // 1. Record the initial state
    const state = Flip.getState(image, {props: "transform"});
    
    // 2. Clone the image for the fullscreen view
    const clone = image.cloneNode(true);
    fullscreenContainer.appendChild(clone);
    
    // 3. Add fullscreen styling to the clone
    clone.style.position = "fixed";
    clone.style.maxWidth = "90vw";
    clone.style.maxHeight = "90vh";
    clone.style.width = "auto";
    clone.style.height = "auto";
    clone.style.top = "50%";
    clone.style.left = "50%";
    clone.style.transform = "translate(-50%, -50%)";
    clone.style.objectFit = "contain";
    clone.style.zIndex = "1001";
    
    // 4. Show the container
    fullscreenContainer.classList.add('active');
    
    // 5. Animate from the initial state to the new state
    Flip.from(state, {
        duration: 0.5,
        ease: "power2.inOut",
        absolute: true,
        targets: clone,
        onComplete: () => {
            // Store reference to the clone
            activeImage = clone;
        }
    });
}

function closeFullscreen() {
    if (!activeImage) return;

    // 1. Get the original image that was clicked
    const originalImage = document.querySelector(`img[src="${activeImage.src}"]`);
    
    // 2. Record the current state of the fullscreen image
    const state = Flip.getState(activeImage, {props: "transform"});
    
    // 3. Apply the original image's dimensions
    activeImage.style.width = "100%";
    activeImage.style.height = "400px";
    activeImage.style.objectFit = "cover";
    activeImage.style.position = "relative";
    activeImage.style.maxWidth = "none";
    activeImage.style.maxHeight = "none";
    activeImage.style.top = "auto";
    activeImage.style.left = "auto";
    activeImage.style.transform = "none";
    
    // 4. Animate back to the thumbnail position
    Flip.from(state, {
        duration: 0.5,
        ease: "power2.inOut",
        absolute: true,
        onComplete: () => {
            // Remove the clone and clean up
            activeImage.remove();
            activeImage = null;
            fullscreenContainer.classList.remove('active');
        }
    });
}


        // Add click listeners to all gallery images
        document.querySelectorAll('.art-item img').forEach(image => {
    image.addEventListener('load', () => {
        // Get the natural dimensions of the image
        const naturalWidth = image.naturalWidth;
        const naturalHeight = image.naturalHeight;
        const aspectRatio = naturalWidth / naturalHeight;

        // You can set a maximum width or height as needed
        const maxWidth = 800;  // example maximum width
        const maxHeight = 600; // example maximum height

        // Calculate new dimensions while maintaining aspect ratio
        let newWidth = naturalWidth;
        let newHeight = naturalHeight;

        // Scale down if wider than max width
        if (newWidth > maxWidth) {
            newWidth = maxWidth;
            newHeight = newWidth / aspectRatio;
        }

        // If height is still too tall, scale based on height instead
        if (newHeight > maxHeight) {
            newHeight = maxHeight;
            newWidth = newHeight * aspectRatio;
        }

        // Apply the new dimensions
        image.style.width = `${newWidth}px`;
        image.style.height = `${newHeight}px`;
    });

    // Add click handler
    image.addEventListener('click', () => openFullscreen(image));
});
        // Close fullscreen when clicking the close button or outside the image
        closeButton.addEventListener('click', closeFullscreen);
        fullscreenContainer.addEventListener('click', (e) => {
            if (e.target === fullscreenContainer) {
                closeFullscreen();
            }
        });

        // Close fullscreen with escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeFullscreen();
            }
        });
    </script>
</body>
</html>